<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <meta charset="utf-8">
    <title>Play</title>
    <link rel="stylesheet" href="{% static 'css/side-nav.css' %}">
    <link rel="stylesheet" href="{% static 'css/style-play.css' %}">
    <link href='https://unpkg.com/boxicons@2.1.2/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">


    <script>
    const room_name = '{{ room }}';
    const creator = '{{ creator }}';
    const number = '{{ number }}';
    const username = '{{ message }}'

    let linkString = window.location.host + '/ws/game/' + room_name + '/';

    console.log(linkString);

    </script>
</head>
<body>

    <div class="sidenav" >
        <div class="user">
            <img src="" alt="" width="150" height="150">
            {% if messages %}
            {% for message in messages %}
            <div><p>{{ message }}</p></div>
            {% endfor %}
            {% endif %}
        </div>
      <div class="options">
        <a href="{% url 'logout' %}"><button>Log out <i class='bx bx-log-out' ></i></button></a>
      </div>

    </div>

    <div class="rightside">

        <form>
            <div class="form-group">
                <textarea class="form-control" id="chat-text"></textarea><br>
            </div>
            <div class="form-group">
                <input class="form-control" id="input" type="text"><br>
            </div>
            <input class="btn btn-secondary btn-lg btn-block" id="submit" type="button" value="send">
        </form>

        <div class="playArea">
            <div class="player" id="creator">

            </div>

            <div class="player" id="p1">

            </div>

            <div class="player" id="p2">

            </div>

            <div class="player" id="p3">

            </div>

            <div class="player" id="p4">

            </div>

            <div class="player" id="p5">

            </div>

            <div class="player" id="p6">

            </div>

            <div class="player" id="p7">

            </div>

        </div>

    </div>

    <div id="playArea"></div>


    <script>
        const user_username = {{ username }}
        document.querySelector('#submit').onclick = function (e) {
            const inputAll = document.querySelector('#input');
            const message = inputAll.value;
            socket.send(JSON.stringify({
                'message': message,
                'username': user_username,
            }))
        }

        const socket = new WebSocket(
            'ws://127.0.0.1:8000' + '/ws/game/' + room_name + '/'
        );

        socket.onmessage = function (e) {
            const data = JSON.parse(e.data);
            console.log(data);
            {#document.querySelector('#playArea').innerHTML = (data.tester);#}
            document.querySelector('#chat-text').value += (data.message + '\n');

        }
    </script>



</body>

<script>

</script>

<script>
    function showElement(id){
        document.getElementById(id).style.visibility = 'visible';
    }
    function hideElement(id){
        document.getElementById(id).style.visibility = 'hidden';
    }

</script>

<script>
    {#document.getElementById("linkElement").innerHTML = linkString;#}

    for (let i = 1; i <= number; i++){
        document.getElementById('p'+i).style.visibility = 'visible';
    }
</script>

</html>